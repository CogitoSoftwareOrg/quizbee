---
import Root from "@/layouts/Root.astro";
import {
  Hero,
  Pains,
  Features,
  HowItWorks,
  Products,
  Testimonials,
  Pricing,
  FAQ,
  CTA,
} from "@cogisoft/ui-astro";
import { getCollection } from "astro:content";

export const getStaticPaths = async () => {
  const landings = await getCollection("landings");
  console.log(landings);
  return landings.map((landing) => {
    const locale = landing.id.split("/")[0];
    const slug = landing.id.split("/")[1];
    return {
      params: { locale, slug },
      props: {
        meta: landing.data.meta,
        sections: landing.data.sections,
      },
    };
  });
};

const { meta, sections } = Astro.props;
---

<Root
  title={meta.title}
  description={meta.description}
  image={meta.image}
  active={meta.active || "home"}
  headerCtaHref={meta.headerCtaHref}
  structuredData={meta.structuredData}
>
  {
    sections.map((section, idx) => {
      switch (section.type) {
        case "Hero":
          return <Hero {...section.props} />;
        case "Pains":
          return <Pains {...section.props} />;
        case "Features":
          return <Features {...section.props} />;
        case "HowItWorks":
          return <HowItWorks {...section.props} />;
        case "Products":
          return <Products {...section.props} />;
        case "Testimonials":
          return <Testimonials {...section.props} />;
        case "Pricing":
          return <Pricing {...section.props} />;
        case "FAQ":
          return <FAQ {...section.props} />;
        case "CTA":
          return <CTA {...section.props} />;
        default:
          return (
            <Fragment
              set:html={`<!-- Unknown section type: ${(section as any).type} at index ${idx} -->`}
            />
          );
      }
    })
  }
</Root>
