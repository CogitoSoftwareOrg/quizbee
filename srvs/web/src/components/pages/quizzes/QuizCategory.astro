---
import type { Page } from "astro";

import Root from "@/layouts/Root.astro";
import { useTranslatedPath } from "@/i18n/utils";
import { defaultLang, type languages } from "@/i18n/ui";
import QuizCategoryCover from "@/components/quizes/QuizCategoryCover.astro";
import Pagination from "@/components/blog/Pagination.astro";
import QuizGrid from "@/components/quizes/QuizGrid.svelte";

const { page } = Astro.props as {
  page: Page;
};

const { locale = defaultLang, category } = Astro.params as {
  locale?: keyof typeof languages;
  category: string;
};

const tp = useTranslatedPath(locale);

const quizes = page.data;
const title = `Quizes · ${category}`;
const desc = `Quizes in "${category}" (${page.currentPage} of ${page.lastPage})`;

// Вспом. форматтер ссылки (если нужен canonical/индексация первой страницы — добавь index.astro)
const pageHref = (n: number) => tp(`/quizes/${category}/page/${n}`);
---

<Root title={title} description={desc} active="quizes">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
    <!-- HERO категории -->
    <section
      class="mb-8 rounded-2xl bg-linear-to-r from-primary-70 to-secondary-70 border p-6 md:p-8 border-base-300"
    >
      <div
        class="flex flex-col md:flex-row md:items-center md:justify-between gap-3"
      >
        <div>
          <h1 class="text-3xl md:text-4xl font-bold tracking-tight capitalize">
            {category}
          </h1>
          <p class="mt-2 text-sm text-muted-foreground">
            {desc}
          </p>
        </div>
        <nav class="text-sm text-muted-foreground">
          <a href={tp("/quizes")} class="hover:underline">Quizes</a>
          <span class="mx-1">/</span>
          <span class="capitalize">{category}</span>
        </nav>
      </div>

      <div
        class="relative w-full h-full aspect-video max-h-[calc(40vh)] mx-auto mt-6"
      >
        <QuizCategoryCover category={category} alt={category} priority="high" />
      </div>
    </section>

    <!-- GRID карточек -->
    <QuizGrid
      client:load
      initialQuizzes={quizes}
      category={category}
      localePrefix={locale === defaultLang ? "" : locale}
    />

    <Pagination page={page} getPageHref={pageHref} />
  </div>
</Root>
