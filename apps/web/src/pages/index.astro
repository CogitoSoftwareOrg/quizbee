---
import { getEntry } from "astro:content";

import { Hero, Pains, Features, HowItWorks, FAQ, CTA } from "@quizbee/ui-astro";

import Root from "@/layouts/Root.astro";
import { urlWithPR } from "@/lib";
import { defaultLang } from "@/i18n/ui";

const landing = await getEntry("landings", `${defaultLang}/quizbee-base`);

const appUrl = urlWithPR(import.meta.env.PUBLIC_APP_URL) as string;
const sections = JSON.parse(
  JSON.stringify(landing?.data.sections).replaceAll("{{APP_URL}}", appUrl)
);
const meta = JSON.parse(
  JSON.stringify(landing?.data.meta).replaceAll("{{APP_URL}}", appUrl)
);
---

<Root
  title={meta?.title || "QuizBee"}
  description={meta?.description}
  image={meta?.image}
  active={meta?.active || "home"}
  headerCtaHref={meta?.headerCtaHref}
  structuredData={meta?.structuredData}
>
  {
    sections.map((section: any, idx: number) => {
      switch (section.type) {
        case "Hero":
          return <Hero {...section.props} />;
        case "Pains":
          return <Pains {...section.props} />;
        case "Features":
          return <Features {...section.props} />;
        case "HowItWorks":
          return <HowItWorks {...section.props} />;
        case "FAQ":
          return <FAQ {...section.props} />;
        case "CTA":
          return <CTA {...section.props} />;
        default:
          return (
            <>
              {`<!-- Unknown section type: ${(section as any).type} at index ${idx} -->`}
            </>
          );
      }
    })
  }
</Root>
